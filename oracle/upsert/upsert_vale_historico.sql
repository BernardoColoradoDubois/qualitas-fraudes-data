MERGE INTO INSUMOS.DM_VALE_HISTORICO tgt
USING RAW_INSUMOS.STG_VALE_HISTORICO stg
ON (tgt.IDVALEHISTORICO = stg.IDVALEHISTORICO)
WHEN MATCHED THEN
  UPDATE SET
    tgt.CONCEPTO = stg.CONCEPTO,
    tgt.NUMPARTE = stg.NUMPARTE,
    tgt.REFERENCIA = stg.REFERENCIA,
    tgt.DESCRIPCION = stg.DESCRIPCION,
    tgt.MONTO = stg.MONTO,
    tgt.LISTA = stg.LISTA,
    tgt.TIPO = stg.TIPO,
    tgt.IDCOSTO = stg.IDCOSTO,
    tgt.IDVALE = stg.IDVALE,
    tgt.FECSURTIDO = stg.FECSURTIDO,
    tgt.IDREFACCION = stg.IDREFACCION,
    tgt.IDCAUSACAMBIOVALE = stg.IDCAUSACAMBIOVALE,
    tgt.USUARIO = stg.USUARIO,
    tgt.FECENVIO = stg.FECENVIO,
    tgt.FECENTREGAREFACCIONARIA = stg.FECENTREGAREFACCIONARIA,
    tgt.FECRECEPCION = stg.FECRECEPCION,
    tgt.NUMEROGUIA = stg.NUMEROGUIA,
    tgt.MENSAJERIA = stg.MENSAJERIA,
    tgt.FECHARECOLECCION = stg.FECHARECOLECCION,
    tgt.GUIARECOLECCION = stg.GUIARECOLECCION,
    tgt.MENSAJERIARECOLECCION = stg.MENSAJERIARECOLECCION,
    tgt.CANTIDADREFACCIONES = stg.CANTIDADREFACCIONES,
    tgt.NUMPARTEVALUADOR = stg.NUMPARTEVALUADOR,
    tgt.IDCAUSACANCELARPIEZA = stg.IDCAUSACANCELARPIEZA
WHEN NOT MATCHED THEN
  INSERT (
    IDVALEHISTORICO,
    CONCEPTO,
    NUMPARTE,
    REFERENCIA,
    DESCRIPCION,
    MONTO,
    LISTA,
    TIPO,
    IDCOSTO,
    IDVALE,
    FECSURTIDO,
    IDREFACCION,
    IDCAUSACAMBIOVALE,
    USUARIO,
    FECENVIO,
    FECENTREGAREFACCIONARIA,
    FECRECEPCION,
    NUMEROGUIA,
    MENSAJERIA,
    FECHARECOLECCION,
    GUIARECOLECCION,
    MENSAJERIARECOLECCION,
    CANTIDADREFACCIONES,
    NUMPARTEVALUADOR,
    IDCAUSACANCELARPIEZA
  )
  VALUES (
    stg.IDVALEHISTORICO,
    stg.CONCEPTO,
    stg.NUMPARTE,
    stg.REFERENCIA,
    stg.DESCRIPCION,
    stg.MONTO,
    stg.LISTA,
    stg.TIPO,
    stg.IDCOSTO,
    stg.IDVALE,
    stg.FECSURTIDO,
    stg.IDREFACCION,
    stg.IDCAUSACAMBIOVALE,
    stg.USUARIO,
    stg.FECENVIO,
    stg.FECENTREGAREFACCIONARIA,
    stg.FECRECEPCION,
    stg.NUMEROGUIA,
    stg.MENSAJERIA,
    stg.FECHARECOLECCION,
    stg.GUIARECOLECCION,
    stg.MENSAJERIARECOLECCION,
    stg.CANTIDADREFACCIONES,
    stg.NUMPARTEVALUADOR,
    stg.IDCAUSACANCELARPIEZA
  );